<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recipe Manager</title>
</head>
<body>
    <h1>Add a New Recipe</h1>
    <form id="recipeForm">
        <div>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>
        </div>
        <div>
            <label for="ingredients">Ingredients (comma-separated):</label>
            <input type="text" id="ingredients" name="ingredients" required>
        </div>
        <div>
            <label for="instructions">Instructions:</label>
            <input type="text" id="instructions" name="instructions" required>
        </div>
        <div>
            <label for="cookingTime">Cooking Time:</label>
            <input type="text" id="cookingTime" name="cookingTime" required>
        </div>
        <button type="submit">Add Recipe</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const recipeId = urlParams.get('id');
            
            // Populate form in case of update
            if (recipeId) {
                populateFormForUpdate(recipeId);
            }
            
            document.getElementById('recipeForm').addEventListener('submit', async function(event) {
                event.preventDefault();
                
                const formData = {
                    title: document.getElementById('title').value,
                    ingredients: document.getElementById('ingredients').value.split(',').map(ingredient => ingredient.trim()),
                    instructions: document.getElementById('instructions').value,
                    cookingTime: document.getElementById('cookingTime').value,
                };
        
                if (recipeId) {
                    await updateRecipe(recipeId, formData);
                } else {
                    await createRecipe(formData);
                }
            });
        });
    
        async function populateFormForUpdate(recipeId) {
            const response = await fetch(`/api/recipes/${recipeId}`);
            if (!response.ok) {
                console.error('Failed to fetch recipe for update');
                return;
            }
            const recipe = await response.json();
            document.getElementById('title').value = recipe.title;
            document.getElementById('ingredients').value = recipe.ingredients.join(', ');
            document.getElementById('instructions').value = recipe.instructions;
            document.getElementById('cookingTime').value = recipe.cookingTime;
            // Change form header or button text if needed
        }
    
        async function updateRecipe(recipeId, data) {
            const response = await fetch(`/api/recipes/${recipeId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            });
            if (!response.ok) {
                alert('Failed to update recipe');
                console.error('Failed to update recipe:', response.statusText);
                return;
            }
            alert('Recipe updated successfully');
            window.location.href = 'recipes.html'; // Redirect or handle as needed
        }
    
        async function createRecipe(data) {
            const response = await fetch('/api/recipes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            });
            if (!response.ok) {
                alert('Failed to create recipe');
                console.error('Failed to create recipe:', response.statusText);
                return;
            }
            alert('Recipe added successfully');
            window.location.href = 'recipes.html'; // Redirect or handle as needed
        }
    </script>
     
</body>
</html>
